# Сбор и аналитическая обработка информации о сетевом трафике
Солдатенкова Ксения БИСО-03-20

## Цель работы

1.  Развить практические навыки использования современного стека
    инструментов сбора и аналитической обработки информации о сетевом
    трафике

2.  Освоить базовые подходы блокировки нежелательного сетевого трафика

3.  Закрепить знания о современных сетевых протоколах прикладного уровня

## План

1.  Получение трафика

2.  Перевод трафика в метаинформацию

3.  Анализ трафика

4.  Определение нежелательного трафика

## Шаги

1\. Получение трафика

С помощью Wireshark было захвачено 289 МБ трафика (файл shark.pcapng).
![Трафик](shark.png)

2\. Перевод трафика в метаинформацию

С помощью утилиты zeek была получена метаинформация о трафике (файл
dns.log).

``` bash
/opt/zeek/bin/zeek -C -r /home/ksu/shark.pcapng
```

3\. Анализ трафика

Для анализа трафика необходимо получить список нежелательных доменов.

``` bash
curl https://winhelp2002.mvps.org/hosts.txt -o hosts
```

      % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                     Dload  Upload   Total   Spent    Left  Speed

      0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
      0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
      0     0    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--     0
      0     0    0     0    0     0      0      0 --:--:--  0:00:02 --:--:--     0
      4  327k    4 16384    0     0   5056      0  0:01:06  0:00:03  0:01:03  5056
    100  327k  100  327k    0     0  74984      0  0:00:04  0:00:04 --:--:-- 74980
    100  327k  100  327k    0     0  74979      0  0:00:04  0:00:04 --:--:-- 79163

С помощью Python подготовим файл для анализа:

``` python
bad_hosts = []
with open('hosts') as file:
    for line in file.readlines()[27:]:
        if line[0] == '#':
            continue
        bad_hosts.append(line.split()[1])
```

Преобразуем полученную метаинформацию в пригодный к анализу вид:

``` python
hosts = []
with open('dns.log') as file:
    for line in file.readlines():
        if line[0] == '#':
            continue
        try:
            hosts.append(line.split()[9])
        except IndexError:
            continue
```

4\. Определение нежелательного трафика

Проанализируем полученный трафик:

``` python
bad_count = len([host for host in hosts if host in bad_hosts])
percentile = round(bad_count/len(hosts),3)*100
print("{} вхождений DNS в список нежелательного трафика.".format(str(bad_count)),
"Процент нежелательного трафика: {}%.".format(str(percentile)),sep='\n')
```

    26 вхождений DNS в список нежелательного трафика.
    Процент нежелательного трафика: 3.5000000000000004%.

## Оценка результата

В результате лабораторной работы мы смогли определить нежелательный
трафик.

## Вывод

## Оценка результата

Мы научились анализировать сетевой трафик и освоили подход блокировки
нежелательного сетевого трафика на основе чёрного списка, используя
современный стек инструментов.
